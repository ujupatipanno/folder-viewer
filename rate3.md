# main.ts 코드 평가 (rate3)

평가 기준:
- **정확성**: 코드가 플러그인의 의도/목적을 제대로 구현하는가
- **간결성**: 최소한의 코드로 기능을 구현했는가 (중복, 불필요한 분기/메서드, 유지보수 비용 포함)

---

## 1) 정확성 평가: 96/100

### 플러그인의 목적 대비 구현 상태

#### ✅ 폴더 기준 파일 목록 뷰 (핵심 목적)
- 현재 활성 파일의 **폴더 경로**를 계산하고 그 폴더 안의 파일만 필터링해서 표시합니다.
- **정렬 기준**: `mtime` 내림차순(최근 수정된 파일이 위로)으로 구현되어 목적과 일치합니다.
- 활성 파일이 없을 때(빈 탭 등)도 **빈 목록**을 렌더링해서 UI 상태가 깨지지 않습니다.

#### ✅ 파일 삭제 UX
- X 아이콘 클릭 시 `fileManager.trashFile()`을 사용해서 **Obsidian 사용자 설정(휴지통/삭제 확인 등)을 존중**합니다.
- `stopPropagation()`으로 파일 열기 클릭과 충돌하지 않게 처리했습니다.
- 예외 발생 시 `Notice` + `console.error`로 사용자/개발자 모두에게 피드백이 남습니다.

#### ✅ 이벤트 기반 갱신
- `workspace.on('file-open')` → 활성 파일이 바뀔 때 뷰 갱신
- `vault.on('create'|'rename'|'modify')` → 활성 폴더에 영향을 줄 때만 갱신되도록 `handleFileChange()`에서 필터링
- `vault.on('delete')` → 활성 파일을 잃을 수 있는 상황을 고려해서, 뷰가 보고 있던 폴더(`view.currentFolderPath`) 기준으로 강제 리렌더링(`view.renderForFolder`) 처리

#### ✅ 이전 폴더로 이동(idea1 목적)
- `previousFolderPath`가 폴더 변경 시 업데이트되고
- 명령어로 이전 폴더의 파일들을 가져와 **가장 최근 수정 파일**을 열어 “이전 폴더로 돌아가기”를 구현합니다.

### 정확성 감점 포인트 (-4)
- **delete 이벤트 로직의 기준 일관성**: delete는 `view.currentFolderPath` 기준으로 강제 렌더, create/rename/modify는 `activeFile` 기준(활성 폴더 기준). 사용자 기대에 따라 이건 장점이 될 수도 있지만, “어떤 뷰를 어떤 기준으로 갱신하는가”가 이벤트마다 달라 약간의 인지 비용이 있습니다. (-2)
- **뷰 선택 방식**: `goToPreviousFolder()`는 첫 번째 leaf만 사용합니다(`leaves[0]`). 뷰가 여러 개 열려있을 때 사용자 기대와 다를 수 있습니다. (-2)

---

## 2) 간결성 평가: 88/100

### 잘 된 점 (간결성 + 유지보수성)

#### ✅ 렌더링 중복 제거
- `renderFolder()` / `renderFileItems()`로 렌더링이 한 곳으로 모여 `updateView()`가 매우 단순해졌습니다.
- 이전 버전의 `updateView()`/`renderViewForFolder()` 중복 구조가 사라져 수정 포인트가 줄었습니다.

#### ✅ 하이라이트 로직의 단순/안정화
- DOM 텍스트(basename) 비교를 없애고 `data-file-path`를 사용해서 **동명 파일** 문제를 피했습니다.
- `updateHighlight()`는 이제 “클래스 토글만” 수행해서 목적이 명확합니다.

#### ✅ 의미 있는 헬퍼 도입
- `getContentContainer()`로 `children[1]` 접근을 한 곳에 모아 가독성이 좋아졌습니다.

### 간결성 감점 포인트 (-12)

#### ❌ delete 버튼 이벤트 리스너가 항목마다 생성
- 각 파일 렌더 시마다 `click` 리스너 2개(fileTitle, deleteButton)가 만들어집니다.
- 이 패턴이 Obsidian 플러그인에서 흔하고 문제는 크지 않지만, 최소 코드/최소 리스너 관점에선 **이벤트 위임(컨테이너 한 번 등록)**으로 더 줄일 수 있습니다. (-4)

#### ❌ 파일 목록 렌더링이 ‘항상 전체 리렌더’ 중심
- modify/create/rename에 대해 `forceUpdate`면 거의 항상 `updateView()`로 전체를 다시 그림.
- 성능 문제가 체감될 정도는 아닐 수 있으나, “최소 작업” 관점에선 더 줄일 여지가 있습니다. (-3)

#### ⚠️ handleFileChange의 forceUpdate 의미는 여전히 약간 추상적
- 로직은 많이 단순해졌지만 `forceUpdate`가 “전체 갱신 여부”인지 “폴더 필터를 적용해야 하는 이벤트인지”인지가 호출부를 보지 않으면 완전히 자명하진 않습니다. (-2)

#### ⚠️ renderEmptyList는 container.empty() 후 div 하나 생성
- 괜찮지만 사실상 `updateView()`에서 처리할 수도 있어, 엄밀한 최소 코드 관점에선 작은 분리 비용이 있습니다. 다만 가독성 이점이 더 크므로 감점은 작게. (-1)

#### ⚠️ goToPreviousFolder의 중복 정렬
- `updateView`와 마찬가지로 `mtime` 정렬이 또 나옵니다(이전 폴더 파일 선택). 이것도 헬퍼로 뽑으면 중복을 조금 더 줄일 수 있습니다. (-2)

---

## 3) 총평

- **정확성은 매우 높습니다.** 폴더 기반 파일 리스트, 삭제 버튼, 이전 폴더 이동, 이벤트 기반 갱신이 플러그인 목적에 맞게 안정적으로 연결되어 있습니다.
- **간결성도 이전보다 확실히 개선되었습니다.** 특히 렌더링 중복 제거와 하이라이트 path 기반 비교가 유지보수 난이도를 크게 낮췄습니다.

추천하는 다음(선택) 리팩터링 2가지:
1. **이벤트 위임**(컨테이너에 클릭 리스너 1개)로 DOM 리스너 수를 줄이기
2. `goToPreviousFolder()`의 정렬/선택 로직을 작은 유틸로 분리해 중복 축소

---

## 4) 점수
- **정확성: 96/100**
- **간결성: 88/100**
- **종합: 92/100**
