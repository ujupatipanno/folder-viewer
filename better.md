# 폴더 보기 플러그인 개선 방안

## 문제 1 해결: 파일 추가/삭제 시 목록 실시간 반영

### 현재 문제점
파일이 추가되거나 삭제되어도 폴더 경로는 동일하므로 하이라이트만 업데이트되고, 실제 파일 목록은 다시 그려지지 않음

### 해결 방안
**updateAllViews 함수의 판단 로직 개선**

- 기존: 폴더 경로가 바뀌었는지만 확인
- 개선: 추가 파라미터로 "강제 전체 업데이트 여부"를 받도록 수정

**이벤트별 처리 방식:**
1. file-open 이벤트: 기존처럼 폴더 경로 비교로 판단
2. create/delete 이벤트: 
   - 변경된 파일이 현재 보고 있는 폴더에 속하는지 먼저 확인
   - 같은 폴더면 강제로 전체 목록을 다시 그림
   - 다른 폴더면 아무것도 하지 않음
3. rename 이벤트:
   - 이름이 바뀐 파일이 현재 폴더에 속하는지 확인
   - 같은 폴더면 전체 목록 다시 그림 (정렬 순서가 바뀔 수 있으므로)
   - 다른 폴더면 무시

---

## 문제 2 해결: 다른 폴더의 변경사항 필터링

### 현재 문제점
Vault 어디서든 파일이 생성/삭제/이름변경 되면 무조건 뷰 업데이트 로직 실행

### 해결 방안
**이벤트 발생 시 폴더 경로 비교 로직 추가**

1. create/delete/rename 이벤트가 발생하면
2. 변경된 파일의 폴더 경로를 추출
3. 현재 활성 파일의 폴더 경로를 추출
4. 두 경로를 비교
5. **같은 폴더일 때만** 뷰 업데이트 수행
6. 다른 폴더면 이벤트 무시

**효과:**
- 불필요한 연산 제거
- 성능 향상
- 대규모 Vault에서도 효율적

---

## 문제 3 해결: 파일 수정 시 정렬 순서 자동 업데이트

### 현재 문제점
파일 내용을 수정해도 mtime이 바뀐 것을 감지하지 못하여 정렬 순서가 업데이트되지 않음

### 해결 방안
**modify 이벤트 리스너 추가**

Obsidian의 vault에는 'modify' 이벤트가 있음. 이것은 파일이 수정되어 저장될 때마다 발생함.

1. vault.on('modify') 이벤트 리스너 등록
2. 이벤트 발생 시 수정된 파일의 폴더 경로 확인
3. 현재 보고 있는 폴더와 같은지 비교
4. 같은 폴더면 목록 전체를 다시 그려서 정렬 순서 업데이트
5. 다른 폴더면 무시

**주의사항:**
- modify 이벤트는 매우 자주 발생할 수 있음 (타이핑할 때마다는 아니지만, 자동 저장될 때마다 발생)
- 성능을 위해 디바운싱(debouncing) 고려 가능
  - 예: 마지막 modify 이벤트 후 1초 대기 후 업데이트
  - 연속으로 수정할 때 매번 다시 그리지 않고 한 번만 그림

---

## 문제 4 해결: 초기 로딩 시 빈 화면 개선

### 현재 문제점
파일이 열려있지 않으면 "파일을 열어주세요" 메시지만 표시되어 플러그인이 작동하는지 불분명

### 해결 방안
**폴백(fallback) 동작 구현**

**옵션 1: Vault 루트 파일 표시**
- 활성 파일이 없으면 Vault 최상위 폴더의 파일들을 표시
- 사용자가 최소한 어떤 파일이 있는지 볼 수 있음

**옵션 2: 최근 사용 폴더 기억**
- 플러그인 데이터에 마지막으로 본 폴더 경로 저장
- 활성 파일이 없을 때 저장된 폴더의 파일 표시
- 플러그인을 껐다 켜도 이전 상태 유지

**옵션 3: 안내 메시지 개선 + 빠른 액션**
- "파일을 열어주세요" 대신 더 유용한 안내 제공
- 예: "Vault에 총 X개의 파일이 있습니다"
- 최근에 열었던 파일 목록을 간단히 표시
- 또는 "Vault 전체 파일 보기" 같은 임시 옵션 제공

**권장 방안: 옵션 1 (Vault 루트 파일 표시)**
- 가장 구현이 간단함
- 추가 데이터 저장 불필요
- 사용자가 바로 파일을 클릭해서 작업 시작 가능
- 루트에 파일이 없더라도 "루트 폴더에 파일이 없습니다" 같은 명확한 메시지 표시

---

## 추가 개선 사항

### 코드 간결성 개선

**중복 코드 제거 방안:**

현재 create, delete, rename, modify 이벤트 핸들러들이 거의 동일한 패턴을 따름:
1. 파일이 TFile 인스턴스인지 확인
2. 활성 파일 가져오기
3. updateAllViews 호출

**개선 방법:**
- 공통 핸들러 함수 하나 만들기
- 이 함수는 변경된 파일을 받아서:
  - 변경된 파일의 폴더와 현재 활성 파일의 폴더를 비교
  - 같으면 뷰 업데이트
  - 다르면 무시
- 각 이벤트 리스너는 이 공통 함수만 호출

**장점:**
- 코드 중복 제거
- 유지보수 용이
- 버그 수정 시 한 곳만 고치면 됨
- 새로운 이벤트 추가 시 재사용 가능

### 성능 최적화

**현재 뷰 경로 추적:**
- 각 뷰가 자신이 현재 표시하고 있는 폴더 경로를 기억
- 이벤트 발생 시 뷰의 폴더와 변경된 파일의 폴더를 직접 비교
- previousFolderPath를 플러그인 레벨이 아닌 뷰 레벨에서 관리

**이점:**
- 여러 뷰가 동시에 열려있을 때도 정확히 작동
- 각 뷰가 독립적으로 업데이트 여부 판단

## 유저의 선택
- 문제 1: 방안대로 진행
- 문제 2: 방안대로 진행
- 문제 3: 방안대로 진행
- 문제 4: 옵션 1로 진행
- 추가 개선 사항: 반영