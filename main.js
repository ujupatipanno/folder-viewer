var f=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var m=(o,t)=>{for(var e in t)f(o,e,{get:t[e],enumerable:!0})},E=(o,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of g(t))!w.call(o,a)&&a!==e&&f(o,a,{get:()=>t[a],enumerable:!(i=F(t,a))||i.enumerable});return o};var P=o=>E(f({},"__esModule",{value:!0}),o);var L={};m(L,{default:()=>p});module.exports=P(L);var r=require("obsidian"),n="folder-files-view",v=class extends r.ItemView{constructor(e){super(e);this.currentFolderPath=null;this.previousFolderPath=null}getContentContainer(){return this.containerEl.children[1]}renderEmptyList(){let e=this.getContentContainer();e.empty(),e.createEl("div",{cls:"folder-files-list"})}renderFileItems(e,i,a){i.forEach(s=>{let c=e.createEl("div",{cls:"tree-item nav-file"}).createEl("div",{cls:"tree-item-self is-clickable nav-file-title"});c.dataset.filePath=s.path,a&&s.path===a.path&&c.addClass("is-active"),c.createEl("div",{text:s.basename,cls:"tree-item-inner nav-file-title-content"});let h=c.createEl("div",{cls:"folder-files-delete-btn tree-item-icon"});(0,r.setIcon)(h,"lucide-x"),c.addEventListener("click",async()=>{await this.app.workspace.getLeaf().openFile(s)}),h.addEventListener("click",async d=>{d.stopPropagation();try{await this.app.fileManager.trashFile(s)}catch(u){new r.Notice(`\uD30C\uC77C \uC0AD\uC81C \uC2E4\uD328: ${u.message}`),console.error("File deletion error:",u)}})})}renderFolder(e,i){let a=this.getContentContainer();a.empty();let s=a.createEl("div",{cls:"folder-files-list"}),c=this.app.vault.getFiles().filter(h=>(h.parent?.path||"")===e).sort((h,d)=>d.stat.mtime-h.stat.mtime);this.renderFileItems(s,c,i)}renderForFolder(e){this.currentFolderPath=e;let i=this.app.workspace.getActiveFile();this.renderFolder(e,i)}getViewType(){return n}getDisplayText(){return"\uD3F4\uB354 \uD30C\uC77C \uBAA9\uB85D"}getIcon(){return"lucide-folder-closed"}async onOpen(){this.updateView()}async onClose(){}updateView(){let e=this.app.workspace.getActiveFile();if(!e){this.currentFolderPath=null,this.renderEmptyList();return}let i=e.parent?.path||"";this.currentFolderPath!==null&&this.currentFolderPath!==i&&(this.previousFolderPath=this.currentFolderPath),this.currentFolderPath=i,this.renderFolder(i,e)}updateHighlight(){let e=this.app.workspace.getActiveFile();if(!e)return;this.getContentContainer().querySelectorAll(".nav-file-title").forEach(s=>{s.removeClass("is-active");let l=s.dataset.filePath;l&&l===e.path&&s.addClass("is-active")})}},p=class extends r.Plugin{async onload(){this.registerView(n,t=>new v(t)),this.addCommand({id:"open-left",name:"\uC67C\uCABD \uC0AC\uC774\uB4DC\uBC14\uC5D0 \uC5F4\uAE30",callback:()=>{this.activateView("left")}}),this.addCommand({id:"open-right",name:"\uC624\uB978\uCABD \uC0AC\uC774\uB4DC\uBC14\uC5D0 \uC5F4\uAE30",callback:()=>{this.activateView("right")}}),this.addCommand({id:"close-view",name:"\uBDF0 \uB2EB\uAE30",callback:()=>{this.closeView()}}),this.addCommand({id:"go-to-previous-folder",name:"\uC774\uC804 \uD3F4\uB354\uB85C \uC774\uB3D9",icon:"lucide-arrow-left",callback:()=>{this.goToPreviousFolder()}}),this.registerEvent(this.app.workspace.on("file-open",t=>{t?this.handleFileChange(t,!1):this.app.workspace.getLeavesOfType(n).forEach(i=>{i.view.updateView()})})),this.registerEvent(this.app.vault.on("create",t=>{t instanceof r.TFile&&this.handleFileChange(t,!0)})),this.registerEvent(this.app.vault.on("delete",t=>{t instanceof r.TFile&&this.app.workspace.getLeavesOfType(n).forEach(i=>{let a=i.view;a.currentFolderPath!==null?a.renderForFolder(a.currentFolderPath):a.updateView()})})),this.registerEvent(this.app.vault.on("rename",(t,e)=>{t instanceof r.TFile&&this.handleFileChange(t,!0)})),this.registerEvent(this.app.vault.on("modify",t=>{t instanceof r.TFile&&this.handleFileChange(t,!0)}))}onunload(){this.app.workspace.detachLeavesOfType(n)}async activateView(t){let{workspace:e}=this.app,i=null,a=e.getLeavesOfType(n);a.length>0?i=a[0]:(t==="left"?i=e.getLeftLeaf(!1):i=e.getRightLeaf(!1),i&&await i.setViewState({type:n,active:!0})),i&&e.revealLeaf(i)}closeView(){let{workspace:t}=this.app;t.getLeavesOfType(n).forEach(i=>{i.detach()})}async goToPreviousFolder(){let t=this.app.workspace.getLeavesOfType(n);if(t.length===0){new r.Notice("\uD3F4\uB354 \uD30C\uC77C \uBAA9\uB85D \uBDF0\uAC00 \uC5F4\uB824\uC788\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.");return}let e=t[0].view;if(!e.previousFolderPath){new r.Notice("\uC774\uC804 \uD3F4\uB354\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.");return}let i=this.app.vault.getFiles().filter(s=>(s.parent?.path||"")===e.previousFolderPath);if(i.length===0){new r.Notice("\uC774\uC804 \uD3F4\uB354\uC5D0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}let a=i.sort((s,l)=>l.stat.mtime-s.stat.mtime);await this.app.workspace.getLeaf().openFile(a[0])}handleFileChange(t,e){let i=this.app.workspace.getActiveFile();if(!i){e&&this.updateAllViews(t,!0);return}let a=i.parent?.path||"",s=t.parent?.path||"";e&&s!==a||this.updateAllViews(i,e)}updateAllViews(t,e=!1){let i=t.parent?.path||"";this.app.workspace.getLeavesOfType(n).forEach(s=>{let l=s.view;e||l.currentFolderPath!==i?l.updateView():l.updateHighlight()})}};
