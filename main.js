var d=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var F=Object.prototype.hasOwnProperty;var m=(n,e)=>{for(var t in e)d(n,t,{get:e[t],enumerable:!0})},E=(n,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of w(e))!F.call(n,i)&&i!==t&&d(n,i,{get:()=>e[i],enumerable:!(a=g(e,i))||a.enumerable});return n};var k=n=>E(d({},"__esModule",{value:!0}),n);var y={};m(y,{default:()=>h});module.exports=k(y);var l=require("obsidian"),r="folder-files-view",v=class extends l.ItemView{constructor(t){super(t);this.currentFolderPath=null}getViewType(){return r}getDisplayText(){return"\uD3F4\uB354 \uD30C\uC77C \uBAA9\uB85D"}getIcon(){return"lucide-folder-closed"}async onOpen(){this.updateView()}async onClose(){}updateView(){let t=this.containerEl.children[1];t.empty();let a=this.app.workspace.getActiveFile(),i=t.createEl("div",{cls:"folder-files-list"});if(!a){this.currentFolderPath=null;return}let s=a.parent?.path||"";this.currentFolderPath=s,this.app.vault.getFiles().filter(c=>(c.parent?.path||"")===s).sort((c,p)=>p.stat.mtime-c.stat.mtime).forEach(c=>{let f=i.createEl("div",{cls:"tree-item nav-file"}).createEl("div",{cls:"tree-item-self is-clickable nav-file-title"});a&&c.path===a.path&&f.addClass("is-active"),f.createEl("div",{text:c.basename,cls:"tree-item-inner nav-file-title-content"}),f.addEventListener("click",async()=>{await this.app.workspace.getLeaf().openFile(c)})})}updateHighlight(){let t=this.app.workspace.getActiveFile();if(!t)return;this.containerEl.children[1].querySelectorAll(".nav-file-title").forEach(s=>{let o=s.querySelector(".nav-file-title-content");if(!o)return;let u=o.textContent;s.removeClass("is-active"),u===t.basename&&s.addClass("is-active")})}},h=class extends l.Plugin{async onload(){this.registerView(r,e=>new v(e)),this.addCommand({id:"open-left",name:"\uC67C\uCABD \uC0AC\uC774\uB4DC\uBC14\uC5D0 \uC5F4\uAE30",callback:()=>{this.activateView("left")}}),this.addCommand({id:"open-right",name:"\uC624\uB978\uCABD \uC0AC\uC774\uB4DC\uBC14\uC5D0 \uC5F4\uAE30",callback:()=>{this.activateView("right")}}),this.addCommand({id:"close-view",name:"\uBDF0 \uB2EB\uAE30",callback:()=>{this.closeView()}}),this.registerEvent(this.app.workspace.on("file-open",e=>{e?this.handleFileChange(e,!1):this.app.workspace.getLeavesOfType(r).forEach(a=>{a.view.updateView()})})),this.registerEvent(this.app.vault.on("create",e=>{e instanceof l.TFile&&this.handleFileChange(e,!0)})),this.registerEvent(this.app.vault.on("delete",e=>{e instanceof l.TFile&&this.handleFileChange(e,!0)})),this.registerEvent(this.app.vault.on("rename",(e,t)=>{e instanceof l.TFile&&this.handleFileChange(e,!0)})),this.registerEvent(this.app.vault.on("modify",e=>{e instanceof l.TFile&&this.handleFileChange(e,!0)}))}onunload(){this.app.workspace.detachLeavesOfType(r)}async activateView(e){let{workspace:t}=this.app,a=null,i=t.getLeavesOfType(r);i.length>0?a=i[0]:(e==="left"?a=t.getLeftLeaf(!1):a=t.getRightLeaf(!1),a&&await a.setViewState({type:r,active:!0})),a&&t.revealLeaf(a)}closeView(){let{workspace:e}=this.app;e.getLeavesOfType(r).forEach(a=>{a.detach()})}handleFileChange(e,t){let a=e.parent?.path||"",i=this.app.workspace.getActiveFile();if(!i&&!t)return;let s=i?.parent?.path||"";t&&a!==s||this.updateAllViews(i||e,t)}updateAllViews(e,t=!1){let a=e.parent?.path||"";this.app.workspace.getLeavesOfType(r).forEach(s=>{let o=s.view;t||o.currentFolderPath!==a?o.updateView():o.updateHighlight()})}};
